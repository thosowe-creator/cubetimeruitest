<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Cube Timer</title>
    <link rel="icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            900: '#0f172a',
                            950: '#020617',
                        }
                    },
                    screens: {
                        'md': '768px' // iPad mini portrait width
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Mobile Bottom Nav Safe Area */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .mb-safe { margin-bottom: env(safe-area-inset-bottom); }
    </style>

    <!-- cubing.js: scrambles + scramble diagrams -->
    <script type="module">
      import { randomScrambleForEvent } from 'https://cdn.cubing.net/v0/js/cubing/scramble';
      // Expose for non-module script.js
      window.__randomScrambleForEvent = randomScrambleForEvent;
    </script>
    <script src="https://cdn.cubing.net/v0/js/scramble-display" type="module"></script>

</head>
<body class="h-full flex flex-col bg-slate-50 dark:bg-slate-950 text-slate-800 dark:text-slate-200 transition-colors duration-200">

    <!-- Header (PC & Mobile shared, layout adjusts) -->
    <header class="w-full h-14 md:h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 px-4 md:px-6 flex items-center justify-between z-40 shrink-0 transition-colors duration-200">
        <div class="flex items-center gap-2">
            <div class="w-7 h-7 md:w-8 md:h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M3 15h18"/><path d="M9 3v18"/><path d="M15 3v18"/></svg>
            </div>
            <h1 class="font-bold text-slate-700 dark:text-slate-200 tracking-tight text-lg md:text-xl">CubeTimer</h1>
        </div>
        <div class="flex items-center gap-2 md:gap-4">
            <button onclick="openBTModal()" id="btToggleBtn" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 transition-all flex items-center justify-center">
                <svg id="btStatusIcon" class="disconnected" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 7 10 10-5 5V2l5 5L7 17"/></svg>
            </button>
            <div class="hidden md:flex items-center bg-slate-100 dark:bg-slate-800 rounded-xl p-1">
                <button onclick="exportData()" class="flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter text-slate-500 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"><span>Backup</span></button>
                <div class="w-px h-3 bg-slate-300 dark:bg-slate-600"></div>
                <button onclick="triggerImport()" class="flex items-center gap-1.5 px-3 py-1.5 text-[10px] font-black uppercase tracking-tighter text-slate-500 dark:text-slate-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors"><span>Restore</span></button>
                <input type="file" id="importInput" class="hidden" accept=".json" onchange="importData(event)">
            </div>
            <button onclick="openSettings()" class="hidden md:block p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-all"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg></button>
        </div>
    </header>

    <!-- Modals (Bluetooth, Session, Mbf, Stats, Settings, Share, UpdateLog, SolveDetail) -->
    <!-- ... (All modals kept exactly the same logic, just existing in HTML) ... -->
    
    <!-- Bluetooth Modal -->
    <div id="btOverlay" class="modal-overlay" onclick="closeBTModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-8" onclick="event.stopPropagation()">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-50 dark:bg-slate-800 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <svg id="btModalIcon" class="text-blue-500" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m7 7 10 10-5 5V2l5 5L7 17"/></svg>
                </div>
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">Bluetooth Timer</h3>
                <p id="btStatusText" class="text-xs text-slate-400 mt-1 font-bold">Connect your Gan Smart Timer</p>
            </div>
            <div id="btInfoPanel" class="hidden bg-slate-50 dark:bg-slate-800 rounded-2xl p-4 mb-6 border border-slate-100 dark:border-slate-700">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-[10px] font-black text-slate-400 uppercase">Device</span>
                    <span id="btDeviceName" class="text-xs font-bold text-slate-600 dark:text-slate-300">-</span>
                </div>
            </div>
            <div class="space-y-3">
                <button id="btConnectBtn" onclick="connectGanTimer()" class="w-full py-4 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-2xl shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2">Connect Timer</button>
                <button id="btDisconnectBtn" onclick="disconnectBT()" class="hidden w-full py-4 bg-red-50 dark:bg-red-900/20 text-red-500 font-bold rounded-2xl active:scale-95 transition-all">Disconnect</button>
                <button onclick="closeBTModal()" class="w-full py-4 text-slate-400 font-bold text-sm">Close</button>
            </div>
        </div>
    </div>

    <!-- Sessions Modal -->
    <div id="sessionOverlay" class="modal-overlay" onclick="closeSessionModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-6" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">Sessions</h3>
                <span id="sessionCountLabel" class="text-[11px] font-bold text-slate-400">0/10</span>
            </div>
            <div id="sessionList" class="space-y-2 mb-6 max-h-[250px] overflow-y-auto custom-scroll pr-1"></div>
            <div id="sessionCreateForm" class="pt-4 border-t border-slate-100 dark:border-slate-800">
                <p class="text-[10px] font-bold text-slate-400 uppercase mb-3">Create New Session</p>
                <div class="flex gap-2">
                    <input type="text" id="newSessionName" placeholder="Session Name" class="flex-1 bg-slate-50 dark:bg-slate-800 dark:text-white border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-2 text-sm outline-none focus:border-blue-400 transition-all">
                    <button onclick="createNewSession()" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold active:scale-95 transition-all">Add</button>
                </div>
            </div>
            <button onclick="closeSessionModal()" class="w-full mt-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Close</button>
        </div>
    </div>

    <!-- Multi-Blind Scramble Modal -->
    <div id="mbfScrambleOverlay" class="modal-overlay" onclick="closeMbfScrambleModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-2xl shadow-2xl p-6 md:p-8 flex flex-col max-h-[90vh]" onclick="event.stopPropagation()">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">Multi-Blind Scrambles</h3>
                <span id="mbfCubeCountDisplay" class="text-[10px] font-bold bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 px-3 py-1 rounded-full uppercase tracking-tighter">10 Cubes</span>
            </div>
            <div id="mbfScrambleList" class="flex-grow overflow-y-auto space-y-4 custom-scroll pr-2 mb-6 text-sm"></div>
            <div class="flex gap-3">
                <button onclick="copyMbfText()" class="flex-1 py-3.5 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl text-sm">Copy All</button>
                <button onclick="closeMbfScrambleModal()" class="flex-1 py-3.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Close</button>
            </div>
        </div>
    </div>

    <!-- Multi-Blind Result Modal (WCA style input) -->
    <div id="mbfResultOverlay" class="modal-overlay" onclick="closeMbfResultModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-6" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">MBF Result</h3>
                <span class="text-[10px] font-black bg-blue-600 text-white px-2 py-1 rounded-md uppercase">333mbf</span>
            </div>
            <p class="text-[11px] text-slate-400 font-bold mb-5">WCA 형식(Attempted / Solved / Time)을 입력해 주세요.</p>
            <div class="space-y-3">
                <div class="flex items-center justify-between gap-3">
                    <label class="text-xs font-bold text-slate-600 dark:text-slate-300" for="mbfAttemptedInput">Attempted</label>
                    <input id="mbfAttemptedInput" type="number" min="1" max="999" inputmode="numeric" class="w-28 bg-slate-50 dark:bg-slate-800 dark:text-white border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-sm font-bold text-center outline-none focus:border-blue-400 transition-all" placeholder="e.g. 10">
                </div>
                <div class="flex items-center justify-between gap-3">
                    <label class="text-xs font-bold text-slate-600 dark:text-slate-300" for="mbfSolvedInput">Solved</label>
                    <input id="mbfSolvedInput" type="number" min="0" max="999" inputmode="numeric" class="w-28 bg-slate-50 dark:bg-slate-800 dark:text-white border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-sm font-bold text-center outline-none focus:border-blue-400 transition-all" placeholder="e.g. 8">
                </div>
                <div class="flex items-center justify-between gap-3">
                    <label class="text-xs font-bold text-slate-600 dark:text-slate-300" for="mbfTimeInput">Time</label>
                    <input id="mbfTimeInput" type="text" inputmode="numeric" class="w-28 bg-slate-50 dark:bg-slate-800 dark:text-white border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-sm font-bold text-center outline-none focus:border-blue-400 transition-all" placeholder="mm:ss">
                </div>
            </div>
            <div id="mbfResultError" class="hidden mt-4 text-[11px] font-bold text-red-500"></div>
            <div class="flex gap-2 mt-6">
                <button onclick="saveMbfResult()" class="flex-1 py-3.5 bg-blue-600 text-white font-bold rounded-xl text-sm shadow-lg active:scale-95 transition-all">Save</button>
                <button onclick="closeMbfResultModal()" class="flex-1 py-3.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Detailed Stats Modal -->
    <div id="statsOverlay" class="modal-overlay" onclick="closeStatsModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-6" onclick="event.stopPropagation()">
            <h3 class="font-bold text-slate-700 dark:text-white text-lg mb-6">Detailed Stats</h3>
            <div class="space-y-3" id="statsContent"></div>
            <button onclick="closeStatsModal()" class="w-full mt-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Close</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsOverlay" class="modal-overlay" onclick="handleOutsideSettingsClick(event)">
	        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-4 sm:p-6 transform transition-all scale-95 opacity-0 duration-200" id="settingsModal" onclick="event.stopPropagation()">
	            <div id="settingsHeader" class="flex items-center justify-between mb-3">
	                <div class="flex items-center gap-2">
	                    <button id="themeBackBtn" onclick="closeThemeSettings()" class="hidden w-9 h-9 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 flex items-center justify-center active:scale-95 transition-all" aria-label="Back">
	                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
	                    </button>
	                    <h3 id="settingsTitle" class="font-bold text-slate-700 dark:text-white text-lg">Settings</h3>
	                </div>
	                <button id="themeResetAllBtn" onclick="resetAllThemeLight()" class="hidden px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-[11px] font-black text-slate-600 dark:text-slate-300 active:scale-95 transition-all">Reset Theme</button>
	            </div>
	            <div id="settingsScroll" class="settings-scroll space-y-4 custom-scroll pr-1">
	                <div id="settingsMainView" class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div><p class="text-xs font-bold text-slate-600 dark:text-slate-300">Dark Mode</p></div>
                    <label class="switch"><input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode(this)"><span class="slider"></span></label>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div><p class="text-xs font-bold text-slate-600 dark:text-slate-300" id="langLabel">Language</p></div>
                    <select id="langSelect" onchange="setLanguage(this.value)" class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl px-3 py-2 text-xs font-bold text-slate-600 dark:text-slate-200 outline-none">
                        <option value="ko">한국어</option>
                        <option value="en">English</option>
                    </select>
                </div>

                <button type="button" onclick="openThemeSettings()" class="w-full flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-700/60 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="w-9 h-9 rounded-xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 flex items-center justify-center">
                            <div class="w-4 h-4 rounded" style="background: linear-gradient(135deg, #3b82f6, #a855f7);"></div>
                        </div>
                        <div class="text-left">
                            <p class="text-xs font-bold text-slate-600 dark:text-slate-300">Theme</p>
</div>
                    </div>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400"><path d="M9 18l6-6-6-6"/></svg>
                </button>

                

<div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div><p class="text-xs font-bold text-slate-600 dark:text-slate-300">Prevent Sleep (Wake Lock)</p></div>
                    <label class="switch"><input type="checkbox" id="wakeLockToggle" onchange="toggleWakeLock(this)"><span class="slider"></span></label>
                </div>
                <div class="flex items-center justify-between p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-2xl border border-yellow-100 dark:border-yellow-800">
                    <div>
                        <p class="text-xs font-bold text-yellow-700 dark:text-yellow-400">WCA Inspection</p>
                        <p class="text-[9px] text-yellow-600/70 dark:text-yellow-500/70 font-medium">15s countdown + voice</p>
                    </div>
                    <label class="switch"><input type="checkbox" id="inspectionToggle" onchange="toggleInspection(this)"><span class="slider"></span></label>
                </div>
                <div class="p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl" id="holdDurationContainer">
                    <div class="flex justify-between items-center mb-2">
                        <p class="text-xs font-bold text-slate-600 dark:text-slate-300">Hold Duration</p>
                        <span id="holdDurationValue" class="text-[10px] font-bold text-blue-500">0.3s</span>
                    </div>
                    <input type="range" id="holdDurationSlider" min="0.0" max="1.0" step="0.1" value="0.3" oninput="updateHoldDuration(this.value)">
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div><p class="text-xs font-bold text-slate-600 dark:text-slate-300">Average Mode</p></div>
                    <div class="flex items-center gap-2"><span class="text-[9px] font-bold text-slate-400">Mo3</span><label class="switch"><input type="checkbox" id="avgModeToggle" checked><span class="slider"></span></label><span class="text-[9px] font-bold text-slate-400">Ao5</span></div>
                </div>
                <div class="flex items-center justify-between p-3 bg-blue-50/50 dark:bg-blue-900/20 rounded-2xl border border-blue-100 dark:border-blue-800">
                    <div><p class="text-xs font-bold text-blue-600 dark:text-blue-400">Manual Entry</p></div>
                    <label class="switch"><input type="checkbox" id="manualEntryToggle"><span class="slider"></span></label>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div><p class="text-xs font-bold text-slate-600 dark:text-slate-300">Precision</p></div>
                    <div class="flex items-center gap-2"><span class="text-[9px] font-bold text-slate-400">.00</span><label class="switch"><input type="checkbox" id="precisionToggle"><span class="slider"></span></label><span class="text-[9px] font-bold text-slate-400">.000</span></div>
                </div>
                <!-- PC Backup Import moved here for mobile if needed, but keeping in header for now -->
                <div class="md:hidden flex gap-2 pt-2">
                    <button onclick="exportData()" class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold rounded-xl">Backup</button>
                    <button onclick="triggerImport()" class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold rounded-xl">Restore</button>
                </div>

	                <!-- About: Release Notes / Developer Log -->
	                <div class="pt-2">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-300 dark:text-slate-600 mb-2">About</p>
                    <div class="flex gap-2">
                        <button onclick="openUpdateLog(false)" class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold rounded-xl">Update Log</button>
                        <button onclick="openKnownIssues()" class="flex-1 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold rounded-xl">Developer Log</button>
                    </div>
                </div>
	                </div>

	                
                <!-- Practice scramble sources -->
                <div id="licenseBlock" class="pt-3">
                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-300 dark:text-slate-600 mb-2">라이센스 / License</p>
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700">
                        <p class="text-[11px] font-bold text-slate-600 dark:text-slate-300 leading-relaxed">
                            Practice scrambles (F2L/OLL/PLL/ZBLS/ZBLL) use alg data & scramble approach adapted from <span class="font-black">Alg-Trainer</span> by Tao Yu (MIT License).
                        </p>
                        <p class="text-[10px] font-bold text-slate-400 mt-2 leading-relaxed">
                            Copyright (c) 2017–2021 Tao Yu — MIT License.
                        </p>
                    </div>
                </div>

<!-- Theme Settings View (Light mode only) -->
	                <div id="themeSettingsView" class="hidden space-y-2">
	                    <p class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-300 dark:text-slate-600 mb-2">Theme Colors</p>
	                    <div class="space-y-2">
	                        <button type="button" onclick="openThemePicker('accent')" class="theme-row">
	                            <div class="theme-row-left">
	                                <div id="themeRowAccentDot" class="theme-dot"></div>
	                                <div class="theme-row-text">
	                                    <p class="theme-row-title">Accent</p>
	                                    <p id="themeRowAccentHex" class="theme-row-sub">#3B82F6</p>
	                                </div>
	                            </div>
	                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="theme-chevron"><path d="M9 18l6-6-6-6"/></svg>
	                        </button>
	                        <button type="button" onclick="openThemePicker('bg')" class="theme-row">
	                            <div class="theme-row-left">
	                                <div id="themeRowBgDot" class="theme-dot"></div>
	                                <div class="theme-row-text">
	                                    <p class="theme-row-title">Background</p>
	                                    <p id="themeRowBgHex" class="theme-row-sub">#F8FAFC</p>
	                                </div>
	                            </div>
	                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="theme-chevron"><path d="M9 18l6-6-6-6"/></svg>
	                        </button>
	                        <button type="button" onclick="openThemePicker('card')" class="theme-row">
	                            <div class="theme-row-left">
	                                <div id="themeRowCardDot" class="theme-dot"></div>
	                                <div class="theme-row-text">
	                                    <p class="theme-row-title">Panels</p>
	                                    <p id="themeRowCardHex" class="theme-row-sub">#FFFFFF</p>
	                                </div>
	                            </div>
	                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="theme-chevron"><path d="M9 18l6-6-6-6"/></svg>
	                        </button>
	                        <button type="button" onclick="openThemePicker('text')" class="theme-row">
	                            <div class="theme-row-left">
	                                <div id="themeRowTextDot" class="theme-dot"></div>
	                                <div class="theme-row-text">
	                                    <p class="theme-row-title">Text</p>
	                                    <p id="themeRowTextHex" class="theme-row-sub">#0F172A</p>
	                                </div>
	                            </div>
	                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="theme-chevron"><path d="M9 18l6-6-6-6"/></svg>
	                        </button>
	                        <button type="button" onclick="openThemePicker('scramble')" class="theme-row">
	                            <div class="theme-row-left">
	                                <div id="themeRowScrambleDot" class="theme-dot"></div>
	                                <div class="theme-row-text">
	                                    <p class="theme-row-title">Scramble Box</p>
	                                    <p id="themeRowScrambleHex" class="theme-row-sub">#FFFFFF</p>
	                                </div>
	                            </div>
	                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="theme-chevron"><path d="M9 18l6-6-6-6"/></svg>
	                        </button>
	                    </div>
	                </div>

	                <!-- Theme Color Picker View -->
	                <div id="themePickerView" class="hidden space-y-3">
	                    <div class="flex items-center justify-between">
	                        <div class="flex items-center gap-2">
	                            <div id="themePickerDot" class="theme-dot"></div>
	                            <div>
	                                <p id="themePickerTitle" class="text-xs font-bold text-slate-700 dark:text-slate-200">Color</p>
	                                <p id="themePickerHex" class="text-[10px] font-black text-slate-400">#FFFFFF</p>
	                            </div>
	                        </div>
	                        <button type="button" onclick="themePickerDefault()" class="text-[10px] font-bold text-slate-400 hover:text-slate-600 dark:hover:text-slate-300">Default</button>
	                    </div>
	                    <div class="theme-picker-wrap">
	                        <div class="theme-sv-wrap">
	                            <canvas id="themeSV" width="220" height="220" class="theme-sv-canvas"></canvas>
	                        </div>
	                        <div class="theme-hue-wrap">
	                            <canvas id="themeHue" width="26" height="220" class="theme-hue-canvas"></canvas>
	                        </div>
	                    </div>
	                    <div class="flex items-center justify-between">
	                        <p id="themePickerRgb" class="text-[10px] font-bold text-slate-400">rgb(255,255,255)</p>
	                        <div class="flex gap-2">
	                            <button type="button" onclick="themePickerCancel()" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-[11px] font-black text-slate-600 dark:text-slate-300 active:scale-95 transition-all">Cancel</button>
	                            <button type="button" onclick="themePickerApply()" class="px-3 py-2 rounded-xl bg-slate-800 dark:bg-slate-700 text-[11px] font-black text-white active:scale-95 transition-all">Apply</button>
	                        </div>
	                    </div>
	                </div>
	            </div>

            <!-- Sticky footer so Save & Close is always reachable on mobile -->
            <div class="settings-footer sticky bottom-0 bg-white dark:bg-slate-900 pt-3 pb-2 border-t border-slate-100 dark:border-slate-800">
                <button onclick="closeSettings()" class="w-full py-3 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl shadow-lg text-sm">Save & Close</button>
            </div>
        </div>
    </div>


    <!-- Case Pool Modal (Practice: ZBLS/ZBLL) -->
    <div id="casePoolOverlay" class="modal-overlay" onclick="handleOutsideCasePoolClick(event)">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-4 sm:p-6 transform transition-all scale-95 opacity-0 duration-200" id="casePoolModal" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-2">
                    <h3 id="casePoolTitle" class="font-bold text-slate-700 dark:text-white text-lg">Case Selection</h3>
                </div>
                <button onclick="closeCasePoolModal()" class="w-9 h-9 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 flex items-center justify-center active:scale-95 transition-all" aria-label="Close">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>

            <div class="space-y-3">
                <div class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div class="flex flex-col">
                        <p id="casePoolModeLabel" class="text-xs font-black text-slate-600 dark:text-slate-300">Mode</p>
                        <p id="casePoolModeHint" class="text-[10px] font-black text-slate-400">Random from all cases</p>
                    </div>
                    <div class="flex items-center gap-1">
                        <button id="casePoolModeAny" type="button" class="case-pool-pill" onclick="setCasePoolMode('any')">Random</button>
                        <button id="casePoolModePool" type="button" class="case-pool-pill" onclick="setCasePoolMode('pool')">Selected</button>
                    </div>
                </div>

                <!-- ZBLS Hand Selection (R / L) -->
                <div id="zblsHandRow" class="hidden flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-2xl">
                    <div class="flex flex-col">
                        <p class="text-xs font-black text-slate-600 dark:text-slate-300">Hand</p>
                        <p class="text-[10px] font-black text-slate-400">R / L</p>
                    </div>
                    <div class="flex items-center gap-1">
                        <button id="zblsHandR" type="button" class="case-pool-pill" onclick="setZblsHandDraft('R')">R</button>
                        <button id="zblsHandL" type="button" class="case-pool-pill" onclick="setZblsHandDraft('L')">L</button>
                    </div>
                </div>

                <div class="flex items-center justify-between">
                    <button id="casePoolClearBtn" type="button" class="px-3 py-2 rounded-xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-[11px] font-black text-slate-600 dark:text-slate-300 active:scale-95 transition-all" onclick="clearCasePoolSelection()">Clear selection</button>
                    <p id="casePoolCount" class="text-[11px] font-black text-slate-500 dark:text-slate-300"></p>
                </div>

                <div id="casePoolList" class="case-pool-list custom-scroll pr-1"></div>

                <div class="flex gap-2 pt-1">
                    <button type="button" class="flex-1 px-4 py-3 rounded-2xl bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 font-black text-slate-700 dark:text-slate-200 active:scale-95 transition-all" onclick="closeCasePoolModal()">Close</button>
                    <button id="casePoolApplyBtn" type="button" class="flex-1 px-4 py-3 rounded-2xl bg-slate-900 dark:bg-white font-black text-white dark:text-slate-900 active:scale-95 transition-all" onclick="applyCasePoolSelection()">Apply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Avg Share Modal -->
    <div id="avgShareOverlay" class="modal-overlay" onclick="closeAvgShare()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-md shadow-2xl p-8" onclick="event.stopPropagation()">
            <div class="flex flex-col mb-6">
                <h4 class="font-bold text-blue-500 uppercase text-[10px] tracking-widest mb-1">[CubeTimer]</h4>
                <p id="shareDate" class="text-slate-400 text-xs font-bold mb-4">Date : -</p>
                <div class="flex items-end justify-between border-b border-slate-100 dark:border-slate-800 pb-4">
                    <span id="shareLabel" class="text-slate-800 dark:text-slate-200 font-bold text-sm">Average of 5 :</span>
                    <span id="shareAvg" class="text-3xl font-bold text-blue-600 dark:text-blue-400 tracking-tighter">0.00</span>
                </div>
            </div>
            <div id="shareList" class="space-y-3 mb-8 max-h-[300px] overflow-y-auto custom-scroll pr-2"></div>
            <div class="flex gap-3">
                <button onclick="copyShareText()" class="flex-1 py-3.5 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl text-sm flex items-center justify-center gap-2">Copy Text</button>
                <button onclick="closeAvgShare()" class="px-6 py-3.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Close</button>
            </div>
        </div>
    </div>

    <!-- Solve Detail Modal -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-md shadow-2xl p-6" onclick="event.stopPropagation()">
            <h4 class="font-bold text-slate-400 uppercase text-[10px] tracking-widest mb-4">Solve Details</h4>
            <div id="modalTime" class="text-3xl font-bold text-slate-800 dark:text-white mb-1">0.00</div>
            <div id="modalEvent" class="text-[10px] font-bold text-blue-500 bg-blue-50 dark:bg-blue-900/30 px-2 py-0.5 rounded w-fit mb-4">3x3x3</div>
            <div class="space-y-1.5 mb-6">
                <span class="text-[9px] font-bold text-slate-400 uppercase">Scramble</span>
                <div id="modalScramble" class="bg-slate-50 dark:bg-slate-800 p-3 rounded-xl text-slate-600 dark:text-slate-300 font-bold text-xs leading-relaxed border border-slate-100 dark:border-slate-700 italic whitespace-pre-line">-</div>
            </div>
            <div class="flex flex-col gap-2">
                <button onclick="openSingleShare()" class="w-full py-3.5 bg-blue-600 text-white font-bold rounded-xl text-sm flex items-center justify-center gap-2">Share Single</button>
                <div class="flex gap-2">
                    <button onclick="useThisScramble()" class="flex-1 py-3.5 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl text-sm">Use Scramble</button>
                    <button onclick="closeModal()" class="flex-1 py-3.5 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl text-sm">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Log Modal -->
    <div id="updateLogOverlay" class="modal-overlay" onclick="closeUpdateLog()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-6" onclick="event.stopPropagation()">
            <div class="flex items-center gap-2 mb-6">
                <div class="p-2 bg-blue-100 dark:bg-blue-900 rounded-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600 dark:text-blue-400"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                </div>
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">Update Log</h3>
            </div>
            <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                    <span id="updateVersion" class="text-xs font-black bg-blue-600 text-white px-2 py-1 rounded-md uppercase">v1.2.0</span>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Latest</span>
                </div>
                <ul id="updateList" class="space-y-2 text-sm font-medium text-slate-600 dark:text-slate-300 marker:text-blue-500 list-disc pl-4"></ul>
            </div>
            <button onclick="closeUpdateLog()" class="w-full py-3.5 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl text-sm shadow-lg hover:bg-slate-700 transition-colors">Okay, Got it!</button>
        </div>
    </div>

    <!-- Developer Log Modal -->
    <div id="knownIssuesOverlay" class="modal-overlay" onclick="closeKnownIssues()">
        <div class="bg-white dark:bg-slate-900 rounded-3xl w-full max-w-sm shadow-2xl p-6" onclick="event.stopPropagation()">
            <div class="flex items-center gap-2 mb-6">
                <div class="p-2 bg-purple-100 dark:bg-purple-900 rounded-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="text-purple-600 dark:text-purple-400"><path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>
                </div>
                <h3 class="font-bold text-slate-700 dark:text-white text-lg">Developer Log</h3>
            </div>
            <div class="mb-6">
                <ul id="knownIssuesList" class="space-y-3 text-sm font-medium text-slate-600 dark:text-slate-300"></ul>
            </div>
            <button onclick="closeKnownIssues()" class="w-full py-3.5 bg-slate-800 dark:bg-slate-700 text-white font-bold rounded-xl text-sm shadow-lg hover:bg-slate-700 transition-colors">Close</button>
        </div>
    </div>

    <!-- Main Content -->
    <!-- Added id='mainContent' and pb-20 for mobile bottom nav space -->
    <main id="mainContent" class="main-container flex flex-col md:flex-row p-4 gap-6 flex-grow min-h-0">
        
        <!-- Timer View Section (Shown by default on Mobile/Desktop) -->
        <div id="timerSection" class="flex-grow flex flex-col items-center justify-start gap-6 order-1 w-full min-h-0">
            <div class="w-full space-y-6">
                <!-- Event Select (Scroll) -->
                <div class="flex flex-col items-center gap-3"> 
                    <h2 class="text-slate-300 dark:text-slate-600 uppercase tracking-[0.2em] text-[10px] font-bold">Event</h2>
                    <div class="w-full max-w-md">
                        <select id="eventSelect" onchange="changeEvent(this.value)" class="w-full bg-white dark:bg-slate-900 border border-slate-100 dark:border-slate-800 rounded-2xl px-4 py-3 text-sm font-bold text-slate-700 dark:text-slate-200 outline-none focus:border-blue-400 transition-all" aria-label="Event selector">
                            <optgroup label="NxN">
                                <option value="333">3x3</option>
                                <option value="222">2x2</option>
                                <option value="444">4x4</option>
                                <option value="555">5x5</option>
                                <option value="666">6x6</option>
                                <option value="777">7x7</option>
                                <option value="333oh">3x3 OH</option>
                            </optgroup>
                            <optgroup label="Etc">
                                <option value="clock">Clock</option>
                                <option value="minx">Megaminx</option>
                                <option value="pyra">Pyraminx</option>
                                <option value="skewb">Skewb</option>
                                <option value="sq1">Square-1</option>
                            </optgroup>
                            <optgroup label="Blind">
                                <option value="333bf">3BLD</option>
                                <option value="444bf">4BLD</option>
                                <option value="555bf">5BLD</option>
                                <option value="333mbf">Multi-BLD</option>
                            </optgroup>
                        
                            <optgroup label="Practice">                                <option value="p_oll">OLL</option>
                                <option value="p_pll">PLL</option>
                                <option value="p_zbls">ZBLS</option>
                                <option value="p_zbll">ZBLL</option>
                            </optgroup>
</select>
                        <!-- (UX) 스크롤 선택 기능은 유지하되 안내 문구는 제거 -->
                    </div>
                </div>

                <!-- Category Select -->
                <div id="legacyCategorySelect" class="hidden flex flex-col items-center gap-4">
                    <div class="flex gap-1 p-1 bg-slate-200/50 dark:bg-slate-800/50 rounded-full border border-slate-200 dark:border-slate-700">
                        <button onclick="switchCategory('standard')" id="cat-standard" class="category-btn active px-6 py-2.5 text-xs font-bold rounded-full transition-colors">NxN</button>
                        <button onclick="switchCategory('nonstandard')" id="cat-nonstandard" class="category-btn px-6 py-2.5 text-xs font-bold rounded-full transition-colors text-slate-500 dark:text-slate-400">Etc.</button>
                        <button onclick="switchCategory('blind')" id="cat-blind" class="category-btn px-6 py-2.5 text-xs font-bold rounded-full transition-colors text-slate-500 dark:text-slate-400">Blind</button>
                        <button onclick="switchCategory(\'practice\')" id="cat-practice" class="category-btn px-6 py-2.5 text-xs font-bold rounded-full transition-colors text-slate-500 dark:text-slate-400">Practice</button>
                    </div>
                    <div class="flex items-center gap-2 w-full">
                        <div id="eventTabScroll" class="bg-white dark:bg-slate-900 p-1 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-800 flex overflow-x-auto max-w-full custom-scroll flex-1">
                        <div id="group-standard" class="flex gap-1">
                            <button onclick="changeEvent('333')" class="event-tab active px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-333">3x3</button>
                            <button onclick="changeEvent('222')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-222">2x2</button>
                            <button onclick="changeEvent('444')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-444">4x4</button>
                            <button onclick="changeEvent('555')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-555">5x5</button>
                            <button onclick="changeEvent('666')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-666">6x6</button>
                            <button onclick="changeEvent('777')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-777">7x7</button>
                            <button onclick="changeEvent('333oh')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-333oh">3x3 OH</button>
                        </div>
                        <!-- ... other groups hidden by default ... -->
                        <div id="group-nonstandard" class="hidden flex gap-1">
                            <button onclick="changeEvent('clock')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-clock">Clock</button>
                            <button onclick="changeEvent('minx')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-minx">Megaminx</button>
                            <button onclick="changeEvent('pyra')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-pyra">Pyraminx</button>
                            <button onclick="changeEvent('skewb')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-skewb">Skewb</button>
                            <button onclick="changeEvent('sq1')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-sq1">Square-1</button>
                        </div>
                        <div id="group-blind" class="hidden flex gap-1">
                            <button onclick="changeEvent('333bf')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-333bf">3BLD</button>
                            <button onclick="changeEvent('444bf')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-444bf">4BLD</button>
                            <button onclick="changeEvent('555bf')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-555bf">5BLD</button>
                            <button onclick="changeEvent('333mbf')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-333mbf">Multi-BLD</button>
                        </div>
                        <div id="group-practice" class="hidden flex gap-1">                            <button onclick="changeEvent('p_oll')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-p_oll">OLL</button>
                            <button onclick="changeEvent('p_pll')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-p_pll">PLL</button>
                            <button onclick="changeEvent('p_zbls')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-p_zbls">ZBLS</button>
                            <button onclick="changeEvent('p_zbll')" class="event-tab px-5 py-2.5 rounded-xl text-xs font-bold text-slate-500 dark:text-slate-400" id="tab-p_zbll">ZBLL</button>
                        </div>

                        </div>

                        <!-- Case selector (only for ZBLS/ZBLL) -->
                        <div id="caseSelectWrap" class="hidden w-full flex items-center justify-center gap-2 px-2 mt-2 flex-wrap">
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Case</span>
                            <button id="casePoolOpenBtn" type="button" class="case-tab" onclick="openCasePoolModal()"></button>
                            <span id="casePoolSummary" class="text-[10px] font-black tracking-widest text-slate-400"></span>
                            <div id="caseTabs" class="hidden"></div>
                            <select id="caseSelect" onchange="changePracticeCase(this.value)" class="hidden"></select>
                        </div>

                    </div>
                </div>

                <!-- Scramble -->
                <div class="text-center w-full">
                    <h2 class="text-slate-300 dark:text-slate-600 uppercase tracking-[0.2em] text-[10px] font-bold mb-3">Scramble</h2>
                    <div id="scrambleBox" class="border border-slate-100 dark:border-slate-800 flex flex-col items-center justify-center md:p-8 p-6 relative rounded-3xl scramble-box transition-colors">
                        <!-- Layout-stable scramble area: reserve space to prevent timer shifting -->
                        <div class="h-5 flex items-center justify-center">
                            <div id="scrambleLoadingRow" class="hidden items-center gap-2">
                                <span class="spinner"></span>
                                <span id="scrambleLoadingText" class="text-[11px] font-bold text-slate-400">Loading scramble…</span>
                            </div>
                        </div>

                        <div id="scramble" class="scramble-text font-bold text-slate-600 dark:text-slate-300 whitespace-pre-wrap text-center leading-relaxed">Generating...</div>

                        <div class="scramble-bottom-area relative w-full flex items-center justify-center">
                            <div id="scrambleDiagramSkeleton" class="hidden scramble-skeleton"></div>
                            <button id="scrambleRetryBtn" onclick="retryScramble()" class="hidden px-5 py-2.5 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 text-xs font-bold active:scale-95 transition-all">Failed. Tap to retry.</button>
                        </div>

                        <div id="mbfInputArea" class="hidden flex flex-col items-center gap-4 w-full">
                            <p class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Enter number of cubes</p>
                            <div class="flex gap-2 w-full max-w-xs">
                                <input type="number" id="mbfCubeInput" min="2" max="100" placeholder="e.g. 10" class="flex-1 bg-slate-50 dark:bg-slate-800 dark:text-white border border-slate-200 dark:border-slate-700 rounded-xl px-4 py-3 text-lg font-bold text-center outline-none focus:border-blue-400 transition-all">
                                <button onclick="generateMbfScrambles()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold active:scale-95 transition-all shadow-md">Go</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timer Area -->
            <div id="timerContainer" class="flex flex-col items-center justify-center flex-grow w-full select-none timer-center-shift">
                <div id="timerInteractiveArea" class="rounded-3xl transition-colors hover:bg-slate-100/30 dark:hover:bg-slate-800/30 w-full h-full flex flex-col justify-center items-center">
                    <div id="timerDisplayContainer" class="w-full flex justify-center">
                        <div id="timer" class="timer-display text-slate-800 dark:text-slate-100 transition-all duration-100">0.00</div>
                        <input type="text" id="manualInput" class="manual-input hidden text-blue-500 dark:text-blue-400" placeholder="0.00">
                    </div>
                    
                    <div class="flex gap-6 mt-8">
                        <div class="avg-badge" onclick="openAvgShare('primary')">
                            <span id="labelPrimaryAvg" class="text-[11px] uppercase font-bold text-blue-400 mb-2 tracking-widest">Ao5</span>
                            <span id="displayPrimaryAvg" class="text-2xl md:text-3xl text-slate-700 dark:text-slate-200 font-bold tracking-tighter">-</span>
                        </div>
                        <div class="avg-badge" onclick="openAvgShare('ao12')">
                            <span class="text-[11px] uppercase font-bold text-purple-400 mb-2 tracking-widest">Ao12</span>
                            <span id="displayAo12" class="text-2xl md:text-3xl text-slate-700 dark:text-slate-200 font-bold tracking-tighter">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="statusHint" class="bg-white dark:bg-slate-800 px-6 py-2 rounded-full text-slate-400 text-xs font-bold tracking-widest shadow-sm border border-slate-100 dark:border-slate-700 uppercase transition-all duration-200"></div>
            </div>
            </div>
        <!-- History View Section (Hidden on Mobile by default, Visible on Desktop) -->
        <div id="historySection" class="hidden md:flex w-full md:w-[360px] history-panel flex-col order-2 overflow-hidden shrink-0 bg-white dark:bg-slate-900 border border-transparent dark:border-slate-800 h-full">
            <div class="p-5 border-b border-slate-100 dark:border-slate-800 flex items-center justify-between bg-white dark:bg-slate-900 shrink-0 rounded-t-3xl">
                <div class="flex items-center gap-2">
                    <h3 class="font-bold text-slate-700 dark:text-slate-200 text-base">History</h3>
                    <button onclick="openSessionModal()" class="flex items-center gap-1.5 px-3 py-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors rounded-full text-slate-500 dark:text-slate-400 group">
                        <span id="currentSessionNameDisplay" class="text-[10px] font-bold max-w-[80px] truncate">Session 1</span>
                        <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400 group-hover:text-slate-600"><path d="m6 9 6 6 6-6"/></svg>
                    </button>
                    <span id="solveCount" class="text-[11px] font-bold bg-blue-50 dark:bg-blue-900/30 text-blue-500 dark:text-blue-300 px-2.5 py-0.5 rounded-full">0</span>
                </div>
                <button id="clearHistoryBtn" class="text-[11px] font-bold text-slate-300 hover:text-red-400 transition-colors uppercase tracking-wider">Clear</button>
            </div>
            
            <div id="historyList" class="flex-grow overflow-y-auto p-4 space-y-2 custom-scroll bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800"></div>
            
            <div class="bg-slate-50 dark:bg-slate-950 shrink-0 rounded-b-3xl">
                <div class="p-5 bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800 grid grid-cols-2 gap-4">
                    <div class="flex flex-col">
                        <div class="flex items-center gap-1.5">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Avg of All</span>
                            <button onclick="showExtendedStats()" class="text-[9px] font-bold text-blue-500 hover:underline cursor-pointer">(More)</button>
                        </div>
                        <span id="sessionAvg" class="text-sm font-bold text-slate-700 dark:text-slate-200">-</span>
                    </div>
                    <div class="flex flex-col items-end">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Personal Best</span>
                        <span id="bestSolve" class="text-sm font-bold text-blue-600 dark:text-blue-400">-</span>
                    </div>
                </div>
                
                <div class="flex flex-col p-4 bg-slate-50/50 dark:bg-slate-900/50 relative">
                    <div class="flex items-center justify-between mb-3 px-2">
                        <span class="text-[10px] font-black uppercase tracking-[0.2em] text-slate-400" id="toolLabel">Scramble Image</span>
                        <div class="relative">
                            <button onclick="toggleToolsMenu(event)" class="flex items-center gap-1.5 px-3 py-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 rounded-lg text-[10px] font-bold text-slate-600 dark:text-slate-300 transition-all shadow-sm active:scale-95">
                                Tools
                                <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="text-slate-400"><path d="m6 9 6 6 6-6"/></svg>
                            </button>
                            <div id="toolsDropdown" class="tools-dropdown">
                                <button onclick="selectTool('scramble')" class="tool-option active" id="tool-opt-scramble">Scramble Image</button>
                                <button onclick="selectTool('graph')" class="tool-option" id="tool-opt-graph">Graph (Trends)</button>
                            </div>
                        </div>
                    </div>

                    <div id="toolContainer" class="flex items-center justify-center">
                        <div id="visualizerWrapper" class="w-full flex justify-center items-center">
                            <scramble-display id="scrambleDiagram" class="scramble-diagram" visualization="2D"></scramble-display>
                            <canvas id="cubeVisualizer" class="hidden" width="260" height="190"></canvas>
                            <div id="noVisualizerMsg" class="hidden text-[11px] text-slate-300 italic">Visualizer for standard cubes only</div>
                        </div>
                        <div id="graphWrapper" class="w-full h-[190px] hidden flex flex-col p-2">
                            <div class="flex-1 bg-white dark:bg-slate-900 rounded-xl border border-slate-100 dark:border-slate-800 shadow-inner overflow-hidden relative">
                                <svg id="historyGraph" viewBox="0 0 100 100" preserveAspectRatio="none" class="w-full h-full p-2">
                                    <polyline id="graphLine" fill="none" stroke="#3b82f6" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" points=""/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Mobile Bottom Navigation (Hidden on PC) -->
    <nav class="md:hidden fixed bottom-0 w-full bg-white dark:bg-slate-950 border-t border-slate-200 dark:border-slate-800 flex justify-around items-center h-16 pb-safe z-50 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
        <button onclick="switchMobileTab('timer')" id="mob-tab-timer" class="flex flex-col items-center justify-center w-full h-full text-blue-600 dark:text-blue-400">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span class="text-[10px] font-bold mt-1">Timer</span>
        </button>
        <button onclick="switchMobileTab('history')" id="mob-tab-history" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
            <span class="text-[10px] font-bold mt-1">Stats</span>
        </button>
        <button onclick="openSettings()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
            <span class="text-[10px] font-bold mt-1">Settings</span>
        </button>
    </nav>

    <!-- 외부 스크립트 연결 -->
    <script src="script.js"></script>
</body>
</html>
